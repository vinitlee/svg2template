// Generated by CoffeeScript 1.8.0
(function() {
  var threshold;

  window.socket = io('http://localhost:3000');

  socket.on('ports', function(data) {
    return console.log(data);
  });

  socket.on('status', function(data) {
    console.log(data);
    if (data.ready) {
      return console.log('Ready to transmit');
    }
  });

  socket.on('serial', function(data) {
    $('.serial').empty();
    return data.ports.forEach(function(port) {
      console.log(port.comName);
      if (port.comName.search('Bluetooth') < 0) {
        return $('.serial').append($('<button>', {
          "class": 'port'
        }).html(port.comName).click((function() {
          $(this).addClass('selected');
          console.log({
            port: $(this).html(),
            baud: 9600
          });
          return socket.emit('serial', {
            port: $(this).html(),
            baud: 9600
          });
        })));
      }
    });
  });

  threshold = 500;

  socket.on('readings', function(data) {
    console.log(data.d);
    if (data.d[0] < threshold * 2) {
      if (data.d[1] > threshold && data.d[1] > data.d[2]) {
        return answer('no');
      } else if (data.d[2] > threshold && data.d[2] > data.d[1]) {
        return answer('yes');
      }
    }
  });

  this.answer = function(ans) {
    clearTimeout(window.resetCard);
    $('.question').removeClass('yes').removeClass('no').addClass(ans);
    return window.resetCard = setTimeout(answer, 1000);
  };

}).call(this);
